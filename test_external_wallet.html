<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–éƒ¨é’±åŒ…è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .iframe-container {
            width: 100%;
            height: 600px;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .controls {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 6px;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #1f2937;
            color: #f9fafb;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .primary { background: #3b82f6; color: white; }
        .secondary { background: #6b7280; color: white; }
        .success { background: #10b981; color: white; }
        .warning { background: #f59e0b; color: white; }
        .error { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å¤–éƒ¨é’±åŒ…è¿æ¥åŠŸèƒ½æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•react-privy-appçš„å¤–éƒ¨é’±åŒ…è¿æ¥åŠŸèƒ½</p>
        
        <div class="iframe-container">
            <iframe id="privyIframe" src="http://localhost:3001"></iframe>
        </div>
        
        <div class="controls">
            <h3>ğŸ“‹ æµ‹è¯•æ“ä½œ</h3>
            <button class="primary" onclick="sendMessage('SYNC_AUTH_STATE')">ğŸ”„ åŒæ­¥è®¤è¯çŠ¶æ€</button>
            <button class="secondary" onclick="sendMessage('OPEN_LOGIN_MODAL', 'wallet')">ğŸ”— è¿æ¥é’±åŒ…</button>
            <button class="success" onclick="sendMessage('OPEN_LOGIN_MODAL', 'google')">ğŸ” Googleç™»å½•</button>
            <button class="warning" onclick="sendMessage('OPEN_LOGIN_MODAL', 'email')">ğŸ“§ é‚®ç®±ç™»å½•</button>
            <button class="error" onclick="sendMessage('LOGOUT_REQUEST')">ğŸšª ç™»å‡º</button>
            
            <div style="margin-top: 10px;">
                <h4>ğŸŒ å¤–éƒ¨é’±åŒ…æµ‹è¯•</h4>
                <button class="primary" onclick="sendMessage('CONNECT_EXTERNAL_WALLET', 'metamask')">ğŸ¦Š MetaMask</button>
                <button class="primary" onclick="sendMessage('CONNECT_EXTERNAL_WALLET', 'coinbase-wallet')">ğŸ’° Coinbase</button>
                <button class="primary" onclick="sendMessage('CONNECT_EXTERNAL_WALLET', 'wallet-connect')">ğŸ”— WalletConnect</button>
                <button class="primary" onclick="sendMessage('CONNECT_EXTERNAL_WALLET', 'rainbow')">ğŸŒˆ Rainbow</button>
                <button class="primary" onclick="sendMessage('CONNECT_EXTERNAL_WALLET', 'phantom')">ğŸ‘» Phantom</button>
            </div>
        </div>
        
        <div class="log" id="log">
            <div>ğŸ“ æ—¥å¿—è¾“å‡º:</div>
            <div id="logContent"></div>
        </div>
    </div>

    <script>
        const iframe = document.getElementById('privyIframe');
        const logContent = document.getElementById('logContent');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #${type === 'error' ? 'ef4444' : type === 'success' ? '10b981' : '6b7280'}">[${timestamp}]</span> ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        function sendMessage(type, data = null) {
            const message = { type };
            if (data) {
                if (type === 'OPEN_LOGIN_MODAL') {
                    message.method = data;
                } else if (type === 'CONNECT_EXTERNAL_WALLET') {
                    message.walletType = data;
                }
            }
            
            log(`ğŸ“¤ å‘é€æ¶ˆæ¯: ${JSON.stringify(message)}`);
            iframe.contentWindow.postMessage(message, '*');
        }
        
        // ç›‘å¬æ¥è‡ªiframeçš„æ¶ˆæ¯
        window.addEventListener('message', (event) => {
            if (event.source !== iframe.contentWindow) return;
            
            log(`ğŸ“¥ æ”¶åˆ°æ¶ˆæ¯: ${JSON.stringify(event.data)}`, 'success');
            
            switch (event.data.type) {
                case 'PRIVY_AUTH_STATE':
                    log(`ğŸ” è®¤è¯çŠ¶æ€: ${event.data.authenticated ? 'âœ… å·²è®¤è¯' : 'âŒ æœªè®¤è¯'}`);
                    if (event.data.authenticated && event.data.user) {
                        log(`ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯: ID=${event.data.user.id}, é‚®ç®±=${event.data.user.email?.address || 'æœªè®¾ç½®'}`);
                    }
                    break;
                    
                case 'WALLET_CREATED':
                    log(`ğŸ’³ é’±åŒ…åˆ›å»ºæˆåŠŸ: ${event.data.wallet.address}`);
                    break;
                    
                case 'EXTERNAL_WALLET_CONNECTED':
                    log(`ğŸŒ å¤–éƒ¨é’±åŒ…è¿æ¥æˆåŠŸ: ${event.data.wallet.address} (${event.data.wallet.walletClientType})`);
                    break;
                    
                case 'PRIVY_ERROR':
                    log(`âŒ é”™è¯¯: ${event.data.error}`, 'error');
                    break;
                    
                default:
                    log(`ğŸ“¨ æœªçŸ¥æ¶ˆæ¯ç±»å‹: ${event.data.type}`);
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆåå‘é€åŒæ­¥è¯·æ±‚
        iframe.onload = () => {
            log('ğŸ”„ iframeåŠ è½½å®Œæˆï¼Œå‘é€åŒæ­¥è®¤è¯çŠ¶æ€è¯·æ±‚');
            setTimeout(() => {
                sendMessage('SYNC_AUTH_STATE');
            }, 1000);
        };
        
        log('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½å®Œæˆ');
    </script>
</body>
</html>