# 状态同步测试指南

## 🎯 测试目标
验证Vue前端与React Privy应用之间的用户认证状态同步是否正常

## 🧪 测试步骤

### 1. 启动所有服务
```bash
# 启动后端服务
cd backend && npm run start:dev

# 启动React Privy应用
cd react-privy-app && npm run dev

# 启动Vue前端应用
cd frontend && npm run dev
```

### 2. 访问测试页面
打开浏览器访问：`http://localhost:3003/test-sync`

### 3. 检查初始状态
- 查看调试信息面板中的各项状态
- 确认"就绪状态"为"就绪"
- 确认"显示状态"为"隐藏"
- 检查控制台是否有定期状态检查输出

### 4. 测试登录流程
1. 点击"测试登录"按钮
2. 观察iframe是否显示
3. 在React应用中进行登录操作
4. 观察Vue前端状态是否更新

### 5. 验证状态同步
登录成功后，检查以下内容：
- **前端状态**："已认证"应显示"是"
- **用户信息**：应显示用户ID、姓名、邮箱
- **钱包信息**：应显示钱包地址和余额
- **状态摘要**：计算属性应反映最新状态

### 6. 测试登出流程
1. 点击"测试登出"按钮
2. 观察状态是否重置
3. 检查所有状态是否恢复为初始值

### 7. 测试强制同步
1. 点击"强制同步"按钮
2. 观察状态是否立即更新
3. 检查控制台中的同步请求日志

## 📊 预期行为

### 正常情况
- 登录后，Vue前端能正确显示用户信息
- 登出后，所有状态正确重置
- 强制同步能立即获取最新状态
- 状态变化时，监听器能正确触发

### 异常情况排查
1. **状态不更新**
   - 检查控制台是否有错误信息
   - 确认消息通信是否正常
   - 检查iframe是否正确加载

2. **用户信息不显示**
   - 检查消息格式是否正确
   - 确认解构逻辑是否正常
   - 验证响应式数据绑定

3. **钱包信息缺失**
   - 检查钱包连接状态
   - 确认钱包地址提取逻辑
   - 验证余额获取功能

## 🔍 调试信息

### 控制台日志
- `=== 状态变化监听器 ===`：状态变化时的详细信息
- `=== 手动状态检查 ===`：手动触发时的状态信息
- `定期状态检查`：每5秒的自动状态检查
- `TestSync收到消息`：接收到的postMessage消息

### 页面日志
- 显示所有重要操作的时间戳和详细信息
- 颜色编码：成功（绿色）、错误（红色）、信息（蓝色）
- 最多保留20条日志记录

## 📝 常见问题

### Q: 状态显示为"无"或"0"
A: 检查消息是否正确发送，用户数据是否完整

### Q: iframe不显示
A: 检查端口冲突，确认React应用正常运行

### Q: 状态不同步
A: 检查postMessage通信，确认消息格式正确

### Q: 控制台无输出
A: 检查浏览器控制台，确认调试模式开启

## 🎉 测试通过标准
- ✅ 所有状态正确显示
- ✅ 登录/登出流程正常
- ✅ 状态同步及时准确
- ✅ 无控制台错误
- ✅ 用户体验流畅